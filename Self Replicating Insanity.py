# Self Replicating Insanity
# github.com/smcclennon/SRI
project_title = 'SRI'
ver = '1.0.0'

# Insane mode (Windows only)
# Each replicated file will be ran in another console window,
# and each of the files ran will replicate and run everything agian

# Quickly sucks up ram, will most likely cause the machine to freeze
# within 30 seconds depending on how powerful the machine is.
# Insane mode tends to generate less files as the machine begins
# to run very slow after a very short amount of time

#Options: True/False
insane_mode = False

project_Self = r"""   _____        _   __
  / ____|      | | / _|
 | (___    ___ | || |_
  \___ \  / _ \| ||  _|
  ____) ||  __/| || |
 |_____/  \___||_||_|"""
project_Replicating = r"""  _____               _  _              _    _
 |  __ \             | |(_)            | |  (_)
 | |__) | ___  _ __  | | _   ___  __ _ | |_  _  _ __    __ _
 |  _  / / _ \| '_ \ | || | / __|/ _` || __|| || '_ \  / _` |
 | | \ \|  __/| |_) || || || (__| (_| || |_ | || | | || (_| |
 |_|  \_\\___|| .__/ |_||_| \___|\__,_| \__||_||_| |_| \__, |
              | |                                       __/ |
              |_|                                      |___/"""
project_Insanity = r"""  _____                            _  _
 |_   _|                          (_)| |
   | |   _ __   ___   __ _  _ __   _ | |_  _   _
   | |  | '_ \ / __| / _` || '_ \ | || __|| | | |
  _| |_ | | | |\__ \| (_| || | | || || |_ | |_| |
 |_____||_| |_||___/ \__,_||_| |_||_| \__| \__, |
                                            __/ |
                                           |___/"""
project_S = r"""   ▄████████
  ███    ███
  ███    █▀
  ███
▀███████████
         ███
   ▄█    ███
 ▄████████▀"""
project_SR = r"""   ▄████████    ▄████████
  ███    ███   ███    ███
  ███    █▀    ███    ███
  ███         ▄███▄▄▄▄██▀
▀███████████ ▀▀███▀▀▀▀▀
         ███ ▀███████████
   ▄█    ███   ███    ███
 ▄████████▀    ███    ███
               ███    ███"""
project_SRI = r"""   ▄████████    ▄████████  ▄█
  ███    ███   ███    ███ ███
  ███    █▀    ███    ███ ███▌
  ███         ▄███▄▄▄▄██▀ ███▌
▀███████████ ▀▀███▀▀▀▀▀   ███▌
         ███ ▀███████████ ███
   ▄█    ███   ███    ███ ███
 ▄████████▀    ███    ███ █▀
               ███    ███"""
project_SRI_2 = r"""   ▄████████    ▄████████  ▄█          ▄████████
  ███    ███   ███    ███ ███         ███    ███
  ███    █▀    ███    █▀  ███         ███    █▀
  ███         ▄███▄▄▄     ███        ▄███▄▄▄
▀███████████ ▀▀███▀▀▀     ███       ▀▀███▀▀▀
         ███   ███    █▄  ███         ███
   ▄█    ███   ███    ███ ███▌    ▄   ███
 ▄████████▀    ██████████ █████▄▄██   ███
                          ▀
   ▄████████    ▄████████    ▄███████▄  ▄█        ▄█   ▄████████    ▄████████     ███      ▄█  ███▄▄▄▄      ▄██████▄
  ███    ███   ███    ███   ███    ███ ███       ███  ███    ███   ███    ███ ▀█████████▄ ███  ███▀▀▀██▄   ███    ███
  ███    ███   ███    █▀    ███    ███ ███       ███▌ ███    █▀    ███    ███    ▀███▀▀██ ███▌ ███   ███   ███    █▀
 ▄███▄▄▄▄██▀  ▄███▄▄▄       ███    ███ ███       ███▌ ███          ███    ███     ███   ▀ ███▌ ███   ███  ▄███
▀▀███▀▀▀▀▀   ▀▀███▀▀▀     ▀█████████▀  ███       ███▌ ███        ▀███████████     ███     ███▌ ███   ███ ▀▀███ ████▄
▀███████████   ███    █▄    ███        ███       ███  ███    █▄    ███    ███     ███     ███  ███   ███   ███    ███
  ███    ███   ███    ███   ███        ███▌    ▄ ███  ███    ███   ███    ███     ███     ███  ███   ███   ███    ███
  ███    ███   ██████████  ▄████▀      █████▄▄██ █▀   ████████▀    ███    █▀     ▄████▀   █▀    ▀█   █▀    ████████▀
  ███    ███                           ▀
 ▄█  ███▄▄▄▄      ▄████████    ▄████████ ███▄▄▄▄    ▄█      ███     ▄██   ▄
███  ███▀▀▀██▄   ███    ███   ███    ███ ███▀▀▀██▄ ███  ▀█████████▄ ███   ██▄
███▌ ███   ███   ███    █▀    ███    ███ ███   ███ ███▌    ▀███▀▀██ ███▄▄▄███
███▌ ███   ███   ███          ███    ███ ███   ███ ███▌     ███   ▀ ▀▀▀▀▀▀███
███▌ ███   ███ ▀███████████ ▀███████████ ███   ███ ███▌     ███     ▄██   ███
███  ███   ███          ███   ███    ███ ███   ███ ███      ███     ███   ███
███  ███   ███    ▄█    ███   ███    ███ ███   ███ ███      ███     ███   ███
█▀    ▀█   █▀   ▄████████▀    ███    █▀   ▀█   █▀  █▀      ▄████▀    ▀█████▀"""


import os, glob, binascii
from time import sleep
from random import randint
absolute_filename = __file__  # 'C:\folder\file.py'
basename = os.path.basename(absolute_filename)  # 'C:\folder\file.py' -> 'file.py'
basename_no_ext = os.path.splitext(basename)[0]  # 'file.py' -> 'file'
basename_ext = os.path.splitext(basename)[1]  # 'file.py' -> '.py'

identifier1 = basename_no_ext + '-' + project_title + '-'  # 'file -SRI-'
identifier2 = basename_ext  # '.py'

if os.name == 'nt':
    Windows = True
else:
    Windows = False
    insane_mode = False  # Disable insane mode due to OS compatability regardless of its previous setting


def logo(code_ID):
    # WORD = full word
    # ACRO = word acronym
    if code_ID == 'WORD_S':
        return project_Self
    elif code_ID == 'WORD_R':
        return project_Replicating
    elif code_ID == 'WORD_I':
        return project_Insanity
    elif code_ID == 'WORD_SR':
        return project_Self + '\n' + project_Replicating
    elif code_ID == 'WORD_SRI':
        return project_Self + '\n' + project_Replicating + '\n' + project_Insanity
    elif code_ID == "WORD_SRI_2":
        return project_SRI_2
    elif code_ID == 'ACRO_S':
        return project_S
    elif code_ID == 'ACRO_SR':
        return project_SR
    elif code_ID == 'ACRO_SRI':
        return project_SRI

display_codes = ['WORD_S', 'WORD_R', 'WORD_I', 'WORD_SR', 'WORD_SRI', 'WORD_SRI_2', 'ACRO_S', 'ACRO_SR', 'ACRO_SRI']


#  Write this file's contents to another python file with a unique name
def replicate(target_file):
    with open(unique_filename(identifier1), "w") as newfile, open(target_file) as program:
        for line in program:
            newfile.write(line)

def unique_filename(old_filename):
    if len(old_filename) > 120:  # If filename over 120 chars
        old_filename = old_filename.replace(project_title+'-', '')[0:30] + basename_ext  # Trim the filename to 30 chars
    new_filename = os.path.splitext(old_filename)[0]
    new_filename = old_filename + str(binascii.b2a_hex(os.urandom(3))).replace("'", '') + identifier2  # Create unique name, convert from b'binary' to 'string'
    return new_filename  # 'file -SRI-b2ad5e2.py'

def find_duplicates(identifier):
    identifier_len = len(str(identifier))  # Get length of identifier (filename)
    identifier_len = int(identifier_len / 2)
    identifier = identifier[0:identifier_len]  # Trim the identifier in half
    return glob.glob(identifier + '*')  # All duplicated files

if __name__ == '__main__':
    duplicate_list = find_duplicates(identifier1)
    if len(duplicate_list) < 2:  # If there is only one SRI script (no replications, yet)
        print(logo('ACRO_SRI'))
        for character in f"Insane Mode: ":  # Animated print
            print(character, end='', flush=True)
            sleep(0.1)
        sleep(0.4)
        for character in f"{'ON' if insane_mode else 'OFF'}":  # Animated print: insane mode status ("ON" or "OFF")
            print(character, end='', flush=True)
            sleep(0.06)
        print('')
    i = 0
    while True:
        print(logo(display_codes[randint(0, len(display_codes)-1)]))  # Print a random fancy text
        replicate(basename)
        duplicate_list = find_duplicates(identifier1)
        selected_file = duplicate_list[randint(0, len(duplicate_list)-1)]
        if insane_mode and Windows:
            i += 1
            os.system('start "'+selected_file+' ===[GEN: '+str(i)+']===" "'+selected_file+'"')  # start "file -SRI-b2ad5e2.py ===[GEN: 0]===" "file -SRI-b2ad5e2.py"